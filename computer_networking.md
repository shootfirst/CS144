

# 概述

## 协议分层

##### 7层iso，osi参考模型

应用层、表示层、会话层、传输层、网络层、数据链路层、物理层

##### 5层因特网协议栈

应用层、传输层、网络层、数据链路层、物理层

应用层位于用户态，而传输层、网络层和部分数据链路层位于内核态，部分数据链路层和物理层为硬件

## 网络和网络中的网络

分层：接入isp、区域isp、第一层isp




# 应用层

网络应用是计算机网络存在的理由

## HTTP

## HTTPS

## DNS

使用53号端口，建立在udp之上

##### 分级

根dns服务器、顶级域服务器、权威dns服务器、本地dns服务器

##### 查询

递归与迭代

##### dns缓存


# 传输层

## UDP

## TCP

##### 可靠数据传输

+ 借助ack和seq两个字段确定，对于连接的双方，都维护着最近已确认的序列号

+ 从上层应用程序接收数据、超时、收到ack触发传送报文段

+ tcp保存已发送但未被接收的最小序列号和下一个要发送字节的序列号

+ 不采取回退n步或选择重传，tcp采取发送发送已发送但未被接收的最小序列号

##### 连接管理

+ 三次握手

+ 四次挥手

##### 超时和重传

+ 超时

+ 快速重传：收到三个冗余ACK，意味着总共收到四个

##### 流量控制

+ 发送方维护winsize，这个由接收方发送表示自己接收方窗口大小

##### 拥塞控制

+ 慢启动

+ 拥塞避免

+ 快恢复



# 网络层

## IP

## IP地址

##### 特殊ip地址

+ 内网ip： 10.0.0.0/8    172.16.0.0/12    192.168.0.0/16

+ 到本地主机的环回地址：127.0.0.0/8

+ 广播地址（同一个广播域）：255.255.255.255

+ 本网络上的本主机，只能用作源地址：0.0.0.0

##### cider

## DHCP

67服务器，68客户端

##### discover message

##### offer message

##### request message

##### ACK message

## NAT

## ICMP

## 路由算法

##### OSPF

自治内部路由算法，基于链路状态算法(ls)

##### BGP

自治系统间路由选择协议，基于距离向量算法(dv)

## 路由器


# 数据链路层

## 多路访问链路和协议

##### 信道划分

##### 随机接入

时隙aloha、aloha、载波侦听多路访问csma、csma\cd

##### 轮流协议

## 局域网

##### ARP

##### 以太网

##### 虚拟局域网

##### 链路层交换机

##### 物理层集线器


# web页面请求历程

dzh同学想访问www.google.com。

首先我的电脑通过dhcp协议请求到ip地址。首先目的端口和源端口为67和68，首先发送discover报文，src为0.0.0.0，目的ip地址为255.255.255.255，会广播校园网，校园网的dhcp服务
器10.250.0.1获取到此报文后，将发送offer报文，提供ip地址10.250.74.134。我的电脑收到之后，发送request报文，src为0.0.0.0，目的ip地址为255.255.255.255向dhcp服务器
请求此ip地址，dhcp服务器收到后，发送ACK报文，确定相关信息。至此。我的电脑获取ip地址10.250.74.134

我在命令行中输入命令wget www.google.com， http提取www.google.com， 发送此字段给位于我电脑中的dns客户端。目的端口为53客户端将数据端封装，传入os内核，经过udp、ip、两层
、层的包装。dns服务器ip地址为8.8.8.8（忽略翻墙）。由于8.8.8.8和我的ip地址不在一个子网，所以使用arp协议查询默认网关10.250.0.1的mac地址.填充给以太网中的目的地mac地址
字段。然后通过网卡将此报文发送出去。首先是从我的电脑传递到默认网关。通过在校园网这一巨大的局域网中传递（其中有集线器和交换机），最终到达默认网关。注意这里会使用nat地
址转化，因为我的ip地址是内网ip地址，10.250.0.1通过查询nat表，将我的ip地址转换成相应端口号，以默认网关的外网ip地址传递出去。然后通过ospf路由算法，在路由器之间传递。
到达边际网关后使用bgp协议到达其他自治区域。最终到达位于美国的8.8.8.8dns服务器。这里默认使用递归查询，dns服务器提取com字段，查询获取相关顶级域服务器的ip地址，在通过此服
务器查询google字段的ip地址，获取后将该ip地址返回给根域名服务器8.8.8.8，8.8.8.8返回该ip地址，和原来的路线相反，该地址包裹在dns数据段中传递回来，目的地是默认网关的外
网ip地址，端口号则是nat转换的端口号。经过nat的转换恢复成10.250.74.134.然后再传递回来。至此，我获取到google.com的ip地址x，我电脑上的dns客户端将此ip地址给http

好，现在开始正式获取我所要请求的网页了。http首先建立和地址x的tcp链接，这里数据在底层传递的过程和上面类似，我就不赘述，这里着重讲述tcp。首先是三次握手。我的电脑发送
syn报文段，该报文段不携带任何数据段，seq字段填入通过随机化产生一个数据，syn标志位置为1。x收到后，也初始化seq字段填入通过随机化产生一个数据，syn标志位置为1，ack标志位置
为1（表示对客户端syn报文段的确认），ack字段设为客户端的seq字段+1，因为syn也占据一个比特位，发送回去为了防止洪范攻击，服务端不会先准备相关缓冲区和字段，而是使用特定哈希
函数计算客户发送的tcp头部的哈希值。我的电脑收到后，确定了连接的建立，准备相关内存缓冲区和相关字段的设置，现在可以发送带有数据段的tcp报文段，这个数据段就是http请求报文，
ack字段为服务端的seq字段+1，seq字段为之前的seq字段+1。服务端收到后，使用相同的哈希函数计算，老报文头和新的只有在seq字段上-1，计算结果相同后，服务器端可以确定连接的建
立，准备相关内存缓冲区和相关字段的设置，将数据段交付给上层的http，http读取相关字段，获取相关文件，传给tcp，服务端填写ack、seq、tcp数据段发送回去。慢启动发送两次后，第三
次超过阈值进入拥塞避免状态，从倍增变为一次增1第三次我的电脑迟迟没有收到，当定时器超时时，我的电脑将发送最早发送但是还未确定的报文段，这样累计发送三次，服务器端使用快速
重传，重传第三次应该发送的数据段，进入快速恢复状态，将ssthresh值变为cwnd/2，最后我的电脑成功收到最后的第三段，服务端重新变为拥塞避免。此时我的电脑获取到了google.com的
网页，通过浏览器将其显示在屏幕上。此时是时候将tcp连接断开。服务端在发送完最后的数据时，fin附上1，我的电脑收到后发送ack。最后我的电脑也发送fin报文段，服务端收到后发送ack
报文段，经过弥留后断开连接。至此，一个网页的获取到此结束。























